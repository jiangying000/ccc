# 自定义Token分配功能

## 新功能说明
CCDRC现在支持自定义前后token分配，让您更灵活地控制会话压缩策略。

## 使用方法

### 1. 启动CCDRC
```bash
ccdrc
```

### 2. 选择会话
输入数字（如`2`）选择一个会话，然后按回车。

### 3. 选择压缩（C）
输入`c`并按回车选择压缩模式。

### 4. 自定义Token分配
系统会提示：
```
🎯 自定义token分配（可选）
  输入格式: 前K 后K (例如: 30 70 表示前30k后70k)
  直接回车使用默认(25 75)
👉 
```

#### 输入示例

**保留更多最近内容（适合调试）：**
```
10 90
```
这将保留前10k tokens和后90k tokens。

**平衡前后（适合长对话）：**
```
50 50
```
这将平均分配，前后各50k tokens。

**保留更多开始内容（适合有重要初始指令）：**
```
70 30
```
这将保留前70k tokens和后30k tokens。

**使用默认值：**
直接按回车，将使用默认的前25k + 后75k分配。

## 应用场景

### 场景1：调试最近的问题
如果您主要关注最近的对话和错误，使用：
```
5 95
```
保留最少的开始内容，最大化最近的上下文。

### 场景2：保持完整的初始设置
如果会话开始有重要的系统提示或配置，使用：
```
80 20
```
保留大部分初始内容。

### 场景3：均衡的长对话
对于需要前后文都重要的长对话，使用：
```
40 60
```
略微偏向最近内容，但保持较好的前文。

## 技术细节

- 单位是k（千）tokens，输入`30 70`表示30,000和70,000 tokens
- 总和不必等于100k，可以是任意组合
- 系统会精确切割消息以达到指定的token数
- 如果某条消息跨越边界，会被智能截断并标记

## 示例输出

```
📊 压缩统计:
  策略: 前30k + 后70k tokens
  原始: 523条消息, 186,432 tokens
  压缩后: 187条消息, 99,876 tokens
  压缩率: 46.4%
```

## 注意事项

1. **Token计算**：使用tiktoken库精确计算，如未安装则使用估算
2. **消息完整性**：系统会尽量保持消息的完整性，只在必要时截断
3. **性能影响**：自定义分配不会影响压缩速度

## 常见问题

**Q: 如果我输入的总和超过100k会怎样？**
A: 系统会按您指定的数量提取，例如输入`60 80`会尝试提取140k tokens。

**Q: 可以只输入一个数字吗？**
A: 不行，必须输入两个数字或直接回车使用默认值。

**Q: 最小可以设置多少？**
A: 理论上可以设置为0，如`0 100`只保留最后100k tokens。

## 更新日志

- **v3.9.0+**: 添加自定义token分配功能
- 支持交互式输入前后token数量
- 显示使用的分配策略